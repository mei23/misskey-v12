<template>
<!-- eslint-disable vue/no-mutating-props -->
<XContainer :draggable="true" @remove="() => $emit('remove')">
	<template #header><i class="fas fa-image"></i> {{ $ts._pages.blocks.image }}</template>
	<template #func>
		<button @click="choose()">
			<i class="fas fa-folder-open"></i>
		</button>
	</template>

	<section class="oyyftmcf">
		<MkDriveFileThumbnail v-if="file" class="preview" :file="file" fit="contain" @click="choose()"/>
	</section>
</XContainer>
</template>

<script lang="ts">
/* eslint-disable vue/no-mutating-props */
import { defineComponent } from 'vue';
import XContainer from '../page-editor.container.vue';
import MkDriveFileThumbnail from '@/components/drive-file-thumbnail.vue';
import * as os from '@/os';

export default defineComponent({
	components: {
		XContainer, MkDriveFileThumbnail
	},

	props: {
		value: {
			required: true
		},
	},

	data() {
		return {
			file: null,
		};
	},

	created() {
		if (this.value.fileId === undefined) this.value.fileId = null;
	},

	mounted() {
		if (this.value.fileId == null) {
			this.choose();
		} else {
			os.api('drive/files/show', {
				fileId: this.value.fileId
			}).then(file => {
				this.file = file;
			});
		}
	},

	methods: {
		async choose() {
			os.selectDriveFile(false).then(file => {
				this.file = file;
				this.value.fileId = file.id;
			});
		},
	}
});
</script>

<style lang="scss" scoped>
.oyyftmcf {
	> .preview {
		height: 150px;
	}
}
</style>
